@if (products && products.count > 0) {
<div class="shop-container mt-20 mb-20">
  <!-- Header Section -->
  <div class="shop-header">
    <!-- 1. Pagination (Blue) -->
    <div class="pagination-area">
      <mat-paginator 
          class="header-paginator" 
          (page)="onPageChanged($event)"
          [length]="products.count" 
          [pageSize]="shopParams.pageSize"
          [showFirstLastButtons]="true" 
          [pageSizeOptions]="pageSizeOptions"
          [pageIndex]="shopParams.pageNumber - 1" 
          aria-label="select page">
      </mat-paginator>
    </div>
    
    <!-- 3. Search Bar (Yellow) -->
    <div class="search-area">
      <form #searchForm="ngForm" (ngSubmit)="onSearch()" class="search-form">
        <input 
            #search
            class="search-input"
            (keyup.enter)="onSearch()"
            placeholder="Search products..." 
            name="search"
            [(ngModel)]="shopParams.search">

        @if (shopParams.search) {
          <button mat-icon-button class="clear-btn" (click)="onResetSearch()" type="button">
            <mat-icon>close</mat-icon>
          </button>
        }

        <button mat-icon-button type="submit" class="search-btn">
          <mat-icon>search</mat-icon>
        </button>
      </form>
    </div>
    
    <!-- 4. Sort Controls (Pink) -->
    <div class="sort-area">
      <div class="sort-controls">
        <button class="sort-btn" mat-stroked-button [matMenuTriggerFor]="sortMenu">
          Sort by
          <mat-icon>keyboard_arrow_down</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="shop-main">
    <!-- Filters Sidebar -->
    <div class="filters-sidebar">
      <div class="filters-header">
        <h3>Filters</h3>
        <button class="clear-all-btn" (click)="onReset()">Clear All</button>
      </div>
      
      <!-- Brands Filter -->
      <div class="filter-section">
        <h4>Brands</h4>
        <div class="filter-options">
          @for (brand of brands; track brand) {
            <label class="filter-option">
              <input 
                type="checkbox" 
                [checked]="isBrandSelected(brand)"
                (change)="onBrandSelected(brand)"> {{brand}}
            </label>
          }
        </div>
      </div>
      
      <!-- Types Filter -->
      <div class="filter-section">
        <h4>Types</h4>
        <div class="filter-options-scrollable">
            <div class="filter-options">
              @for (type of types; track type) {
                <label class="filter-option">
                  <input 
                    type="checkbox" 
                    [checked]="isTypeSelected(type)"
                    (change)="onTypeSelected(type)"> {{type}}
                </label>
              }
            </div>
        </div>
      </div>
      
      <!-- Price Range Filter -->
      <div class="filter-section">
        <h4>Price Range</h4>
        <div class="price-range">
          <input 
            type="range" 
            min="0" 
            max="500" 
            class="price-slider" 
            id="priceRange"
            [(ngModel)]="priceValue"
            (input)="onPriceInputChange($event)">
          <div class="price-labels">
            <span class="price-min">${{priceValue}}</span>
            <span class="price-max">$500+</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Products Grid -->
    <div class="products-section">
      <div class="products-grid">
        @for (product of products.data; track product.id) {
        <app-product-item [product]="product"></app-product-item>
        }
      </div>
      
      <!-- Pagination -->
      <div class="pagination-section">
        <mat-paginator 
            class="custom-paginator" 
            (page)="onPageChanged($event)"
            [length]="products.count" 
            [pageSize]="shopParams.pageSize"
            [showFirstLastButtons]="true" 
            [pageSizeOptions]="pageSizeOptions"
            [pageIndex]="shopParams.pageNumber - 1" 
            aria-label="select page">
        </mat-paginator>
      </div>
    </div>
  </div>
</div>

<mat-menu #sortMenu="matMenu">
  <mat-selection-list [multiple]="false" #sortList
      (selectionChange)="onSortSelectedFromMenu($event)">
    @for (sort of sortOptions; track $index) {
    <mat-list-option [value]="sort.value"
        [selected]="shopParams.sort === sort.value">{{sort.name}}
    </mat-list-option>
    }
  </mat-selection-list>
</mat-menu>
} @else {
  <app-empty-state 
    message="No products match this filter"
    icon="filter_alt_off"
    actionText="Reset filters"
    (click)="onReset()"
  />
}
